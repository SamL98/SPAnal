# SPAnal

This repository contains a suite of scripts useful for analyzing iOS armv7 binaries in Radare2. It is titles SPAnal because the original target binary for these scripts was Spotify.

## Motivation

My usual disassembler of choice is IDA but the free version does not support armv7. Ghidra's decompiler takes until the heat death of the universe to decompile a binary on the order of 10's of MB. Therefore, I use Radare2. However, Radare2's auto-analysis also takes ages and gigabytes of memory on such a large binary. The goal of these scripts is to basically perform the analysis Radare2 would normally do on selected classes or methods so that it doesn't take so long.

## Scripts

### get_classlist.py

This script walks the `__objc_classlist` section of the Mach-O file and builds a JSON object of the classes defined in the binary. The JSON object is formatted as such:

'''
{
	<class name>: {
		"methods": {
			<selector name>: <implementation pointer>,
			...
		},
		"ivars": {
			<instance variable name>: <instance variable type>,
			...
		}
	},
	...
}
'''

This script performs basically the same function as the `classdump` tool but formats the output as a JSON file. The name of the output file is specified as the first commandline argument.

### process_class.py

This script uses the JSON classes object generated by `get_classlist.py` to process every method of a certain class using the `process_method.py` script. The class name is specified as the first commandline argument.

### process_method.py

Tells Radare2 to analyze the given method and then resolves the selectors used and receivers of objc_msgSend calls from within the function. The method name is specified as the first commandline argument and is formatted as <class name>.<selector name>.
